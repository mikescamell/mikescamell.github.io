
<head>
    <meta charset="utf-8">

    <title>Shared Element Transitions with RecyclerView</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../favicon.ico">

    <meta name="description" content="A tutorial to show how to implement Shared Element Transitions on Android when using a RecyclerView and going to a new Activity, Fragment or ViewPager.">
    <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="../index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Mike Scamell">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Shared Element Transitions with RecyclerView">
    <meta property="og:description" content="A tutorial to show how to implement Shared Element Transitions on Android when using a RecyclerView and going to a new Activity, Fragment or ViewPager.">
    <meta property="og:url" content="http://localhost:2368/shared-element-transitions-part-4-recyclerview/">
    <meta property="og:image" content="http://localhost:2368/content/images/2018/11/recycler_view_feature-2.png">
    <meta property="article:published_time" content="2017-02-21T15:01:00.000Z">
    <meta property="article:modified_time" content="2018-11-18T19:36:39.000Z">
    <meta property="article:tag" content="androiddev">
    <meta property="article:tag" content="sharedelementtranistions">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Shared Element Transitions with RecyclerView">
    <meta name="twitter:description" content="A tutorial to show how to implement Shared Element Transitions on Android when using a RecyclerView and going to a new Activity, Fragment or ViewPager.">
    <meta name="twitter:url" content="http://localhost:2368/shared-element-transitions-part-4-recyclerview/">
    <meta name="twitter:image" content="http://localhost:2368/content/images/2018/11/recycler_view_feature-2.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Mike Scamell">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="androiddev, sharedelementtranistions">
    <meta name="twitter:site" content="@mikescamell">
    <meta property="og:image:width" content="1280">
    <meta property="og:image:height" content="600">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Mike Scamell",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.ico",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Mike Scamell",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/2a389d50c33966a79a8cf6fe29c6080e?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "http://localhost:2368/author/mike/",
        "sameAs": []
    },
    "headline": "Shared Element Transitions with RecyclerView",
    "url": "http://localhost:2368/shared-element-transitions-part-4-recyclerview/",
    "datePublished": "2017-02-21T15:01:00.000Z",
    "dateModified": "2018-11-18T19:36:39.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:2368/content/images/2018/11/recycler_view_feature-2.png",
        "width": 1280,
        "height": 600
    },
    "keywords": "androiddev, sharedelementtranistions",
    "description": "A tutorial to show how to implement Shared Element Transitions on Android when using a RecyclerView and going to a new Activity, Fragment or ViewPager.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.6">
    <link rel="alternate" type="application/rss+xml" title="Mike Scamell" href="../../rss/index.html">

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,600,400">
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather", serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans", sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-moz-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-o-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-moz-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-o-font-feature-settings:"liga" 1, "onum" 1, "kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata, monospace, sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata, monospace, sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans", sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans", sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans", sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans", sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../">Mike Scamell</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Shared Element Transitions - Part 4: RecyclerView</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../author/mike/">Mike Scamell</a></p>
                    <time class="post-date" datetime="2017-02-21">2017-02-21</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="http://localhost:2368/content/images/2018/11/recycler_view_feature-2.png" width="600" height="400" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <p>In <a href="http://mikescamell.com/shared-element-transitions-part-3/">part 3</a> of the series we looked at how to implement Shared Element Transitions when using Picasso or Glide.</p><p>In part 4 we're going to look at implementing them with <code>RecyclerView</code>, a popular use case with apps that have Shared Element Transitions. An example of this is Google Play Music, which i mentioned in <a href="http://mikescamell.com/shared-element-transitions-part-1/">part 1</a>, but there are plenty more out there.  Pocket Casts is another good example:</p><p>We're going to make something similar, going from a gallery of Animals to a detail page telling us a bit more info. Here's our two screens:</p><figure class="kg-card kg-image-card"></figure><p>I'm going to show three examples. Two using <code>Activity</code> and <code>Fragment</code> to go from a <code>RecyclerView</code> to a simple detail view. Finally one going from a <code>RecyclerView</code> to a <code>ViewPager</code>.</p><p>There's one key point that I want to get across, in case you decide to skip to other parts of the post. That is that Shared Element Transitions need a UNIQUE transition name. This is easy to forget but is key when doing them with <code>RecyclerView</code>. Enough chuff, let's get on with it!</p><h2 id="common-code">Common Code</h2><p>First of all lets look at some common code to all the examples. Let's start with the layout for the gallery items.</p><h3 id="animal-gallery-item-layout">Animal Gallery Item Layout</h3><pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="150dp"
    android:layout_marginBottom="16dp"&gt;

    &lt;ImageView
        android:id="@+id/item_animal_square_image"
        android:layout_width="match_parent"
        android:layout_height="match_parent" /&gt;

&lt;/RelativeLayout&gt;
</code></pre><p>Nothing fancy, but the key thing to note is there is NO <code>transitionName</code> attribute set on the <code>ImageView</code>.</p><h3 id="animal-gallery-adapter">Animal Gallery Adapter</h3><pre><code>public class AnimalGalleryAdapter extends RecyclerView.Adapter&lt;AnimalGalleryAdapter.ImageViewHolder&gt; {

    private final AnimalItemClickListener animalItemClickListener;
    private ArrayList&lt;AnimalItem&gt; animalItems;

    public AnimalGalleryAdapter(ArrayList&lt;AnimalItem&gt; animalItems, AnimalItemClickListener animalItemClickListener) {
        this.animalItems = animalItems;
        this.animalItemClickListener = animalItemClickListener;
    }

    ....

    @Override
    public void onBindViewHolder(final ImageViewHolder holder, int position) {
        final AnimalItem animalItem = animalItems.get(position);

        Picasso.with(holder.itemView.getContext())
                .load(animalItem.imageUrl)
                .into(holder.animalImageView);

        ViewCompat.setTransitionName(holder.animalImageView, animalItem.name);

        holder.itemView.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                animalItemClickListener.onAnimalItemClick(holder.getAdapterPosition(), animalItem, holder.animalImageView);
            }
        });
    }
}
</code></pre><p>Here we have our <code>AnimalGalleryAdapter</code>. This will be used throughout all the examples to show the gallery images.</p><p>On line 6 in the constructor we ask for an <code>AnimalItemClickListener</code> which will handle calling back to the relevant <code>Activity</code> or <code>Fragment</code> to launch the animal detail screen.</p><p>The <code>onBindViewHolder</code> method is where we set the <code>transitionName</code>. As previously mentioned, this has to be unique in the view hierarchy, so we <s>construct one with an arbitrary string and append the position of the item onto the end.</s> use the Animal's name as we know this will be unique. It's best if you can use some unique identifier derived from your model. If we set the <code>transitionName</code> in XML then all <code>ImageView</code> in the gallery would have the same one, which means when we came back to the gallery the framework would have no idea where to move the image to. Which results in some weird image movement and clashing! Line 21 we set the <code>transitionName</code> on the <code>ImageView</code> using <code>ViewCompat</code>. <s>Line 23 we set the dynamic <code>transitionName</code> on the <code>ImageView</code>.</s></p><p>We fire <code>onAnimalItemClick</code> on line 26 when an image is tapped. We give it the position, the <code>AnimalItem</code> that was clicked, and finally the <code>ImageView</code>. <s>and finally <code>transitionName</code>. The <code>transitionName</code> isn't entirely necessary as we set it on the <code>ImageView</code>, but it help keeps the code cleaner as calling <code>getTransitionName</code> on an <code>ImageView</code> is only available 21+.</s> We can use <code>ViewCompat</code> to call <code>getTransitionName</code> on the <code>ImageView</code> as we have done in previous examples.</p><h3 id="animal-item">Animal Item</h3><pre><code>public class AnimalItem implements Parcelable {

    public String name;
    public String detail;
    public String imageUrl;

    ...
}
</code></pre><p>Our AnimalItem is pretty simple. We need the image URL to tell Picasso (can easily be swapped for Glide) what image to load in our detail <code>Activity</code> or <code>Fragment</code>. It's also <code>Parcelable</code> so we can pass on through by adding to the extras <code>Bundle</code> of the <code>Intent</code>.</p><h2 id="recyclerview-to-activity">RecyclerView to Activity</h2><p>This is probably the most simple to implement. In our <code>RecyclerViewActivity</code> we just need to handle the <code>onAnimalItemClick</code> and launch the <code>AnimalDetailActivity</code>.</p><pre><code>public class RecyclerViewActivity extends AppCompatActivity implements AnimalItemClickListener {

    //Code to setup the RecyclerView and Adapter

    @Override
    public void onAnimalItemClick(int pos, AnimalItem animalItem, ImageView sharedImageView) {
        Intent intent = new Intent(this, AnimalDetailActivity.class);
        intent.putExtra(EXTRA_ANIMAL_ITEM, animalItem);
        intent.putExtra(EXTRA_ANIMAL_IMAGE_TRANSITION_NAME, ViewCompat.getTransitionName(sharedImageView));

        ActivityOptionsCompat options = ActivityOptionsCompat.makeSceneTransitionAnimation(
                this,
                sharedImageView,
                ViewCompat.getTransitionName(sharedImageView));

        startActivity(intent, options.toBundle());
    }

}
</code></pre><p>Line 8 and 9 we put our <code>AnimalItem</code> and <code>transitionName</code> in the <code>Bundle</code> to be passed through to the <code>AnimalDetailActivity</code>. Line 11-14 we do what we did in <a href="http://mikescamell.com/shared-element-transitions-part-1/">part 1</a> and create <code>ActivityOptions</code> using the <code>ImageView</code> passed through from the <code>AnimalGalleryAdapter</code>. <s>and the <code>transitionName</code>.</s> We add the <code>ActivityOptions</code> when we call <code>startActivity</code> on line 16.</p><p>Now we need to setup the <code>AnimalDetailActivity</code>.</p><pre><code>public class AnimalDetailActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_animal_detail);
        supportPostponeEnterTransition();

        Bundle extras = getIntent().getExtras();
        AnimalItem animalItem = extras.getParcelable(RecyclerViewActivity.EXTRA_ANIMAL_ITEM);

        ImageView imageView = (ImageView) findViewById(R.id.animal_detail_image_view);
        TextView textView = (TextView) findViewById(R.id.animal_detail_text);
        textView.setText(animalItem.detail);

        String imageUrl = animalItem.imageUrl;
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
            String imageTransitionName = extras.getString(RecyclerViewActivity.EXTRA_ANIMAL_IMAGE_TRANSITION_NAME);
            imageView.setTransitionName(imageTransitionName);
        }

        Picasso.with(this)
                .load(imageUrl)
                .noFade()
                .into(imageView, new Callback() {
                    @Override
                    public void onSuccess() {
                        supportStartPostponedEnterTransition();
                    }

                    @Override
                    public void onError() {
                        supportStartPostponedEnterTransition();
                    }
                });
    }
}
</code></pre><p>We need to stop the <code>AnimalDetailActivity</code> loading before Picasso has finished loading the image from the image url. So line 7 we call <code>supportPostponeEnterTransition</code> to tell it to wait. Line 19 we get the <code>transitionName</code> from the <code>extras</code> and set it on the <code>ImageView</code> of the <code>AnimalDetailActivity</code>. This is key, as we DON'T set the <code>transitionName</code> in the layout XML of the <code>AnimalDetailActivity</code>. <s>This is because we don't know it until someone has actually clicked an Animal from the gallery. So we have to set it dynamically.</s> It's not necessary though, and if you wanted you could set this on the <code>ImageView</code> via the layout if you like, but you'd need to set it when creating the <code>ActivityOptionsCompat</code> in <code>RecyclerViewActivity</code>. Line 23-36 we use Picasso to load the image and in the <code>onSuccess</code> and <code>onError</code> methods of the callback we tell the <code>AnimalDetailActivity</code> that it can now launch by calling <code>supportStartPostponedEnterTransition</code>. This was talked about in detail in <a href="http://mikescamell.com/shared-element-transitions-part-3/">part 3</a>. With that everything should work!</p><h2 id="recyclerview-to-fragment">RecyclerView to Fragment</h2><p>There's not too much difference between using a <code>Fragment</code> compared with the above code for the <code>Activity</code> example. So I'm just going to touch on the key differences. Here's our <code>RecyclerViewFragment</code> which gets loaded from the <code>Activity</code> that holds the Fragments.</p><pre><code>public class RecyclerViewFragment extends Fragment implements AnimalItemClickListener {

    //Code to setup RecyclerView and Adapter

    @Override
    public void onAnimalItemClick(int pos, AnimalItem animalItem, ImageView sharedImageView, String transitionName) {
        Fragment animalDetailFragment = AnimalDetailFragment.newInstance(animalItem, transitionName);
        getFragmentManager()
                .beginTransaction()
                .addSharedElement(sharedImageView, ViewCompat.getTransitionName(sharedImageView))
                .addToBackStack(TAG)
                .replace(R.id.content, animalDetailFragment)
                .commit();
    }
}
</code></pre><p>In the <code>onAnimalItemClick</code> method we create our <code>FragmentTransaction</code>. On line 10 we add the <code>ImageView</code> <s>and dynamic <code>transitionName</code></s> that has been passed through from the <code>AnimalGalleryAdapter</code>. We use it to get the <code>transitionName</code>. Just like the <code>Activity</code> example, we need to pass through our <code>AnimalItem</code> and <code>transitionName</code> which we do when creating our <code>Fragment</code> on line 7.</p><pre><code>public class AnimalDetailFragment extends Fragment {

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        postponeEnterTransition();
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
            setSharedElementEnterTransition(TransitionInflater.from(getContext()).inflateTransition(android.R.transition.move));
        }
    }

    @Override
    public void onViewCreated(View view, @Nullable Bundle savedInstanceState) {
        super.onViewCreated(view, savedInstanceState);

        AnimalItem animalItem = getArguments().getParcelable(EXTRA_ANIMAL_ITEM);
        String transitionName = getArguments().getString(EXTRA_TRANSITION_NAME);

        TextView detailTextView = (TextView) view.findViewById(R.id.animal_detail_text);
        detailTextView.setText(animalItem.detail);

        ImageView imageView = (ImageView) view.findViewById(R.id.animal_detail_image_view);
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
            imageView.setTransitionName(transitionName);
        }

        Picasso.with(getContext())
                .load(animalItem.imageUrl)
                .noFade()
                .into(imageView, new Callback() {
                    @Override
                    public void onSuccess() {
                        startPostponedEnterTransition();
                    }

                    @Override
                    public void onError() {
                        startPostponedEnterTransition();
                    }
                });
    }
}
</code></pre><p>Again, just like the <code>Activity</code> example we have to tell the <code>Fragment</code> to wait to load until we tell it so by calling <code>postponeEnterTransition()</code> on line 7. Line 9 we call <code>setSharedElementTransition()</code> otherwise we won't get one and we just inflate the transition <code>move</code> from the Android resources to tell it what type of <code>Transition</code> we want.</p><p>Line 25 we set the <code>transitionName</code> on the <code>ImageView</code>. <s>as it's dynamic.</s> Like the Actvivity example, this isn't necessary and we could just set a <code>transitionName</code> via XML and then use it here. We load the image using Picasso (28-41) and make sure we call <code>startPostponedEnterTransition()</code> in the image load callback's <code>onSuccess()</code> and <code>OnError()</code> methods so that the <code>Fragment</code> actually loads.</p><p>So as you can see, apart from the <code>Fragment</code> specific calls, the <code>Activity</code> and <code>Fragment</code> examples are both pretty much the same. I won't post a video as it's identical to the one above for the <code>Activity</code>!</p><h2 id="bonus-recyclerview-to-viewpager">Bonus: RecyclerView to ViewPager</h2><p>I was asked about this scenario last week and so I've decided to throw it in as well. There's just one caveat to this example. As you'll likely know the nature of a ViewPager is that you can swipe to change pages. This proves an issue with a Shared Element Transition's return transition. You might have moved in the ViewPager and no longer have the <code>View</code> you did the Shared Element Transition with in the first place. If you do there's also the chance you'll be on an adjacent page, so when you press back the first image transitions back rather than the one that you are on. Take a look at the video to see what I mean.</p><p>There's hardly any difference in code to the above <code>Fragment</code> example apart from using a <code>ViewPager</code> and this little snippet:</p><pre><code>public class AnimalViewPagerFragment extends Fragment {

    ///Other setup code

    @Override
    public void onCreate(@Nullable Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        postponeEnterTransition();
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) {
            setSharedElementEnterTransition(TransitionInflater.from(getContext()).inflateTransition(android.R.transition.move));
        }
        setSharedElementReturnTransition(null);
    }
}
</code></pre><p>On line 12 we call <code>setSharedElementReturnTransition()</code> and set it to <code>null</code> so that it doesn't perform a return Shared Element Transition. This way, when the back buttons pressed, there'll be no odd return transition. If you know a way round this I'd be keen to hear, I have a few ideas myself but I ran out of time this week to try them! Note I'm calling this on the <code>Fragment</code> that's going to be created, NOT the one that's loading it. It'll look something like this:</p><p>And that's it for this week. In part 5 I'll be focusing on gotchas. We'll use some of the previous examples and get them into a state when we no longer have that nasty white flash! If you haven't seen it go back and look at some of the videos above. You'll never unsee it again! We'll also look at stopping the images overlapping the navigation and status bars.</p><p>The source code for this can be found <a href="https://github.com/mikescamell/shared-element-transitions">here</a> under the package <code>recycler_view</code>.</p><p><em>Update (5/03/17): I've made some minor adjustments to this post since first releasing. There's nothing better than having 1000's of eyes on your work for reviewing!</em></p>

            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../">Mike Scamell</a> © 2018</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
